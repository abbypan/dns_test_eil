<?xml version='1.0' encoding='ascii'?>
<!DOCTYPE rfc SYSTEM "rfc2629.dtd">
<rfc category="info" docName="draft-pan-dnsop-edns-isp-location" obsoletes="" updates="" submissionType="IETF" xml:lang="en">
  <front>
    <title abbrev="ISP Location in DNS Queries">ISP Location in DNS Queries</title>
    <author initials="L." surname="Pan" fullname="Lanlan Pan">
      <address>
        <postal>
          <street/>
          <city>Beijing</city>
          <region/>
          <code/>
          <country>CN</country>
        </postal>
        <phone/>
        <email>abbypan@gmail.com</email>
        <uri>https://github.com/abbypan</uri>
      </address>
    </author>
    <author initials="Y." surname="Fu" fullname="Yu Fu">
      <organization>CNNIC</organization>
      <address>
        <postal>
          <street>No.4 South 4th Street, Zhongguancun</street>
          <street/>
          <city>Beijing</city>
          <region/>
          <code/>
          <country>CN</country>
        </postal>
        <phone/>
        <email>fuyu@cnnic.cn</email>
      </address>
    </author>
    <date month="April" year="2017"/>
    <area>General</area>
    <workgroup>dnsop</workgroup>
    <keyword>dns</keyword>
    <keyword>ip</keyword>
    <keyword>EIL</keyword>
    <keyword>ECS</keyword>
    <keyword>location</keyword>
    <abstract>
      <t>This document describes an Extension Mechanisms for DNS (EDNS0) option that is in active use to carry information about the network that originated a DNS query and the network for which the subsequent response can be cached.</t>
      <t>It is inspired by EDNS Client Subnet (ECS) with some privacy considerations, goals to reduce the "guess geolocation of client's IP" work on Authoritative Nameservers.</t>
    </abstract>
  </front>
  <middle><!--This document was prepared using Pandoc2rfc, https://github.com/miekg/pandoc2rfc --><section title="Introduction" anchor="introduction" toc="default"><t>As described in <xref target="RFC7871" pageno="false" format="default">EDNS Client Subnet (ECS)</xref>, many Authoritative Nameservers today return different responses based on the perceived topological location of the user.  These servers use the IP address of the incoming query to identify that location. ECS is an <xref target="RFC6891" pageno="false" format="default">EDNS0</xref> option to carry client subnet information in DNS queries for Authoritative Nameserver. Compared to source IP address of DNS query, ECS will help Authoritative Nameserver to guess the client's location more precisely because of the DNS forwarding query structure.  </t><t>However, ECS raises some privacy concerns because it leaks client subnet information on the resolution path to the Authoritative Nameserver.  </t><t>Meanwhile, many Authoritative Nameservers support GeoIP feature, for example, <xref target="BIND-GeoIP" pageno="false" format="default">BIND-GeoIP</xref>, <xref target="PowerDNS-GeoIP" pageno="false" format="default">PowerDNS-GeoIP</xref>, <xref target="Amazon-Geolocation-Routing" pageno="false" format="default">Amazon-Geolocation-Routing</xref>, <xref target="DYN-Traffic-Director-ECS" pageno="false" format="default">DYN-Traffic-Director-ECS</xref>, <xref target="gdnsd-GeoIP" pageno="false" format="default">gdnsd-GeoIP</xref>, etc. They guess the user's geolocation by the client subnet of ECS or by the source IP address of DNS query, return tailor DNS response based on the user's geolocation. To sum up, these Authoritative Nameservers use ECS client subnet information for GeoIP feature's user geolocation detecting.  </t><t>This document is an improved solution for ECS-enabled GeoIP feature of Authoritative Nameserver, describes an EDNS ISP Location (EIL) extension to address the privacy problem of ECS, find the right balance between privacy improvement and user experience optimization. EIL is defined to convey isp location &lt; COUNTRY, AREA, ISP &gt; information that is relevant to the DNS message. It will directly provide the same sufficient information for the GeoIP-based Authoritative Nameserver that enabling ECS, to decide the response without guessing geolocation of the IP address.  </t><t>EIL is intended for those Local Forwarding Resolvers, Recursive Resolvers and Authoritative Nameservers that would benefit from the extension and not for general purpose deployment like ECS scenario.  It could be applied for tailor DNS response. EIL can safely be ignored by servers that choose not to implement or enable it.  </t><section title="Path Calculation and Tailored DNS Response" anchor="path-calculation-and-tailored-dns-response" toc="default"><t>Separate the consideration of path calculation (Data Provider) and tailored DNS response (Authoritative Nameserver).  </t><t>Data Providers make path calculations to optimize content delivery on the Internet based on the network topology, considering many factors such as IP, RIPs, FIBs, AS Path hops, system load, content availability, path latency, etc. Note that, Data Providers have the full details of the clients, they can make any complex path calculations without ECS and EIL.  </t><t>Authoritative Nameservers configure tailored DNS response based on the result of path calculations, allocate IP addresses to different datacenters. Usually, users from the same &lt; COUNTRY, AREA, ISP &gt; isp location are allocated to the same datacenter, the same best "network topologically close" datacenter.  For example, client IP addresses from &lt; China, Beijing, Telecom &gt; are allocated to DataCenter-1, client IP addresses from &lt; China, Beijing, Unicom &gt; are allocated to DataCenter-2, etc.  Above is the GeoIP-based Tailored DNS Response.  </t><t>Therefore, if the GeoIP-based Authoritative Nameservers enable ECS, they can use the client subnet information of ECS instead of resolver's address for GeoIP detecting. Moreover, the GeoIP-based Authoritative Nameservers can directly use the &lt; COUNTRY, AREA, ISP &gt; information of EIL without GeoIP detecting.  </t><t>Again, we emphasize that tailored DNS response does not affect path calculation. Data Providers can make path calculations based on network topology, decide network topological close datacenter for each IP address. Authoritative Nameservers allocate tailored DNS response to each IP address based on the "network topological close" result of path calculations. EIL tell Authoritative Nameserver like that, "I want to know what is best IP address for clients from &lt; China, Beijing, Telecom &gt; at network topology path calculations result", but not "I want to know what is the nearest IP address for clients from &lt; China, Beijing, Telecom &gt; at physical topology path calculations result".  </t><t>EIL is satisfied if Authoritative Nameservers aggregate the IP addresses from the same &lt; COUNTRY, AREA, ISP &gt; isp location to visit the same datacenters, we call that GeoIP-based tailored DNS responses, and these tailored responses have "network topological close" distance to the users.  </t><t>ECS is satisfied if Authoritative Nameservers make tailored DNS response down to subnet precise level. For example, (subnet-1, ..., subnet-100) are from the same &lt; COUNTRY, AREA, ISP &gt; isp location, Data Provider applies (subnet-1, ..., subnet-50) visit DataCenter-1, (subnet-51, ..., subnet-100) visit DataCenter-2.  </t></section></section><section title="Requirements Language" anchor="requirements-language" toc="default"><t>The key words "MUST", "MUST NOT", "REQUIRED", "SHALL", "SHALL NOT", "SHOULD", "SHOULD NOT", "RECOMMENDED", "NOT RECOMMENDED", "MAY", and "OPTIONAL" in this document are to be interpreted as described in <xref target="RFC2119" pageno="false" format="default"/> when they appear in ALL CAPS. When these words are not in ALL CAPS (such as "should" or "Should"), they have their usual English meanings, and are not to be interpreted as <xref target="RFC2119" pageno="false" format="default"/> keywords.  </t></section><section title="Terminology" anchor="terminology" toc="default"><t>Basic terms used in this specification are defined in the documents <xref target="RFC1034" pageno="false" format="default"/>, <xref target="RFC1035" pageno="false" format="default"/>, <xref target="RFC7719" pageno="false" format="default"/> and <xref target="RFC7871" pageno="false" format="default"/>.  </t><t>EIL: EDNS ISP Location.  </t><t>ECS: EDNS Client Subnet, described in <xref target="RFC7871" pageno="false" format="default"/>.  </t><t>Local Forwarding Resolver: Forwarding Resolver is described in <xref target="RFC7871" pageno="false" format="default"/>. It is the first Forwarding Resolver which receives DNS queries from Stub Resolver, usually deployed nearby the first-hop router such as public Wi-Fi hotspot routers and home routers.  </t><t>Recursive Resolver: described in <xref target="RFC7871" pageno="false" format="default"/>. It is the last-hop before Authoritative Nameserver in the DNS query path.  </t><t>Intermediate Nameserver: described in <xref target="RFC7871" pageno="false" format="default"/>. Any nameserver in between the Stub Resolver and the Authoritative Nameserver, such as a Recursive Resolver or a Forwarding Resolver.  </t><t>Intermediate Forwarding Resolver: Any Forwarding Resolver in between the Local Forwarding Resolver and Recursive Resolver.  </t><t>Authoritative Nameserver: described in <xref target="RFC7719" pageno="false" format="default"/> and <xref target="RFC2182" pageno="false" format="default"/>.  It is a server that knows the content of a DNS zone from local knowledge, and thus can answer queries about that zone without needing to query other servers.  </t></section><section title="Overview" anchor="overview" toc="default"><t>This document provides an EDNS0 option to allow Local Forwarding Resolvers and Recursive Resolvers, if they are willing, to forward details about the isp location of client when talking to other nameservers.  </t><t>The format of EIL option is described in Section 5. EIL can be added in queries sent by Local Forwarding Resolvers or Recursive Resolvers in a way that is transparent to Stub Resolvers and end users. EIL is only defined for the Internet (IN) DNS class.  </t><t>Like ECS, Authoritative Nameservers could provide a better answer by using precise isp location in EIL. Intermediate Nameservers could send EIL query and cache the EIL response. This document also provides a mechanism to signal Intermediate Nameservers that they do not want EIL treatment for specific queries.  </t><t>The security concerns for EIL are like ECS, such as cache growth, spoof EDNS0 option and privacy, etc. Mitigation techniques are discussed in Section 6.  </t></section><section title="The EIL EDNS0 option" anchor="the-eil-edns0-option" toc="default"><t>The EIL is an EDNS0 option to include the isp location of client in DNS messages.  </t><t>It is 14 octets which is structured as follows: </t><figure title="" suppress-title="false" align="left" alt="" width="" height=""><artwork xml:space="preserve" name="" type="" align="left" alt="" width="" height="">
                +0 (MSB)                            +1 (LSB)
      +---+---+---+---+---+---+---+---+---+---+---+---+---+---+---+---+
   0: |                         OPTION-CODE                           |
      +---+---+---+---+---+---+---+---+---+---+---+---+---+---+---+---+
   2: |                         OPTION-LENGTH                         |
      +---+---+---+---+---+---+---+---+---+---+---+---+---+---+---+---+
   4: |                         COUNTRY-CODE                          |
      +---+---+---+---+---+---+---+---+---+---+---+---+---+---+---+---+
   6: |                         AREA-CODE                             |
      |                                                               |
      |                                                               |
      +---+---+---+---+---+---+---+---+---+---+---+---+---+---+---+---+
  12: |                         ISP                                   |
      |                                                               |
      +---+---+---+---+---+---+---+---+---+---+---+---+---+---+---+---+

      Total: 14 octets.
</artwork></figure><t><list style="symbols"><t>OPTION-CODE, 2 octets, defined in <xref target="RFC6891" pageno="false" format="default"/>. EDNS option code should be assigned by the IANA.  </t><t>OPTION-LENGTH, 2 octets, defined in <xref target="RFC6891" pageno="false" format="default"/>, contains the length of the payload (everything after OPTION-LENGTH) in octets.  </t><t>COUNTRY-CODE, 2 octets, uppercase, defined in <xref target="ISO3166" pageno="false" format="default"/>, indicates the country information of the client&#8217;s IP. For example, China's COUNTRY-CODE is CN.  </t><t>AREA-CODE, 6 octets, uppercase, defined in <xref target="ISO3166" pageno="false" format="default"/> country subdivision code, indicates the area information of the client&#8217;s IP. For example, The AREA-CODE of Fujian Province in China is 35.  </t><t>ISP, 4 octets, uppercase, indicates the ISP information of the client&#8217;s IP, using shortcut names. ISP shortcut names are unique within the context of the COUNTRY-CODE. For example, the shortcut name of China Telecommunications Corporation is TEL, the shortcut name of China United Network Communications is UNI, the shortcut name of China Mobile is MOB, etc.  </t></list></t><t>All fields are in network byte order ("big-endian", per <xref target="RFC1700" pageno="false" format="default"/>, Data Notation).  </t><t>The aim to use short names in the fields is to limit the data size of EIL, decrease the DDoS risk.  </t><t>The null value 0x20 signifies that the field is unknown. If all fields in EIL are set to null value, it means that client doesn't want to use EIL.  </t><t>Authoritative Nameservers can send EIL response with the * value 0x2A in AREA-CODE field or ISP field (not COUNTRY-CODE field), which signifies that the field is wildcard match. For example, &lt; CN, *, TEL &gt; indicates: all area in China, Telecom ISP.  </t><t>Example code is in Github at: https://github.com/abbypan/dns_test_eil .  </t></section><section title="Protocol Description" anchor="protocol-description" toc="default"><section title="Originating the Option" anchor="originating-the-option" toc="default"><t>The EIL can be initialized by Public Recursive Resolver, ISP Recursive Resolver, or Local Forwarding Resolver.  </t><section title="P-Model: Public Recursive Resolver" anchor="p-model-public-recursive-resolver" toc="default"><t>Public Recursive Resolvers are not close to many users because the service providers couldn't deploy servers in every country and every ISP's network, which will affect the response accuracy of Authoritative Nameservers. To encounter this problem, ECS shifts the client subnet information to Authoritative Nameserver, but rises user privacy concerns.  </t><t>Therefore, to keep balance between precise and privacy, when a Public Recursive Resolver receives a DNS query, it can guess isp location of client's IP and generate the EIL OPT data, then send EIL query to the Authoritative Nameserver. This will move the "guess location of client&#8217;s IP" work from Authoritative Nameserver back to Public Recursive Resolver, lighten the burden of Authoritative Nameserver, but increase DDoS risk on Public Recursive Resolver.  </t><t>In order to improve the user's privacy, if a Recursive Resolver receives a DNS query with ECS, it can guess the isp location of SOURCE-PREFIX from the ECS OPT data, and make a new DNS query with EIL, then send the query to Authoritative Nameserver which supports EIL.  </t><t>P-model is the most recommended and close to the ECS.  </t></section><section title="I-Model: ISP Recursive Resolver" anchor="i-model-isp-recursive-resolver" toc="default"><t>ISP Recursive Resolver only serves its customers, each of whom has a static isp location. ISP Recursive Resolver can add EIL transparent to end user, and then Authoritative Nameserver doesn't need to "guess location of client&#8217;s IP".  </t><t>EIL will be benefit if the Authoritative Nameserver could not find the approximate isp location of ISP Recursive Resolver, which is crucial to DNS response accuracy in ECS.  </t></section><section title="L-Model: Local Forwarding Resolver" anchor="l-model-local-forwarding-resolver" toc="default"><t>Local Forwarding Resolver is usually on the first-hop router, such as public Wi-Fi hotspot routers and Cisco/Linksys/Netgear/TP-LINK home routers.  </t><t>When a Local Forwarding Resolver that implements EIL receives a DNS query from an end user, it surely can know about the isp location of client&#8217;s IP, and generate the EIL OPT data, then send the EIL query to the intermediate Recursive Resolver.  Intermediate Recursive Resolver sends the EIL query to the Authoritative Nameserver.  </t><t>In this scenario, both Public Recursive Resolver and Authoritative Nameserver don't need to "guess location of client's IP", because the Local Forwarding Resolver supplies the isp location precisely. That is, EIL can reduce dependence on the IP geolocation database quality, which is crucial to DNS response accuracy in ECS.  </t><t>If a Local Forwarding Resolver had sent a query with EIL, and receives a REFUSE response, it MUST regenerate a query with no EIL.  </t></section></section><section title="Generating a Response" anchor="generating-a-response" toc="default"><section title="Whitelist" anchor="whitelist" toc="default"><t>EIL contains a whitelist for COUNTRY-CODE, AREA-CODE and ISP, which can be discussed or maintained by the DNSOP working group.  Authoritative Nameservers that supporting EIL must only response the EIL queries matched the whitelist. Recursive Resolver that supporting EIL must only cache the EIL responses matched the whitelist.  </t></section><section title="Authoritative Nameserver" anchor="authoritative-nameserver" toc="default"><t>Using the isp location specified in the EIL option of DNS query, an Authoritative Nameserver can generate a tailored response.  </t><t>Authoritative Nameservers that have not implemented or enabled support for the EIL ought to safely ignore it within incoming queries, response the query as a normal case without EDNS0 option. Such a server MUST NOT include an EIL option within replies to indicate lack of support for it.  </t><t>An Authoritative Nameserver that has implemented this protocol and receives an EIL option MUST include an EIL option in its response to indicate that it SHOULD be cached accordingly.  </t><t>An Authoritative Nameserver will return a more appropriate tailored response for the query with an EIL option containing more precisely AREA-CODE.  </t></section><section title="Intermediate Nameserver" anchor="intermediate-nameserver" toc="default"><t>Like ECS, Intermediate Nameserver passes a DNS response with an EIL option to its client when the client indicates support EIL.  </t><t>If an Intermediate Nameserver receives a response that has a larger area than the AREA-CODE provided in its query, it SHOULD still provide the result as the answer to the triggering client request even if the client is in a smaller area.  </t></section></section><section title="Handling EIL Responses and Caching" anchor="handling-eil-responses-and-caching" toc="default"><t>If an Intermediate Nameserver had sent a query with EIL, and receives a NOERROR response without EIL option, it SHOULD treat this answer as suitable for all clients.  </t><t>Other handling considerations are similar with <xref target="RFC7871" pageno="false" format="default">ECS</xref>, SECTION 7.3.  </t><section title="Caching the Response" anchor="caching-the-response" toc="default"><t>In the cache, all resource records in the Answer section MUST be tied to the isp location specified in the response. The Answer section is valid for all areas which the EIL option covered. For example, an EIL option &lt; CN, 35, TEL &gt; covers all 9 Cities in Fujian Province of China Telecommunications ISP.  </t><t>Same with ECS, The Additional and Authority sections are excluded.  </t><t>Enabling support for EIL in an Intermediate Nameserver will increase the size of the cache, and prevent "client subnet leak" privacy concern of ECS.  </t></section><section title="Answering from Cache" anchor="answering-from-cache" toc="default"><t>Cache lookups are first done as usual for a DNS query, using the query tuple of &lt; name, type, class &gt;. Then, the appropriate RRset MUST be chosen based on the isp location matching.  </t><t>If there was an EIL option, the Intermediate Nameserver will lookup for &lt; same COUNTRY-CODE, same ISP, same AREA-CODE &gt; of the same query tuple in the cache. Otherwise, try to find &lt; same COUNTRY-CODE, same ISP, same AREA-CODE &gt; of the same query tuple in the cache.  </t><t>If no EIL option was provided, the safest choice of the Intermediate Nameserver is dealing the query as a normal case without EDNS0 option.  </t><t>If no EIL option was provided, but the Intermediate Nameserver want to be more aggressive, it can guess the isp location from the source IP of the query, then respond as if there was an EIL option with the guessed information. Users can be benefit when the Intermediate Nameserver has a more precise IP location database than the Authoritative Nameserver, especially in global public DNS service like GoogleDNS(8.8.8.8).  </t><t>If no matching is found, the Intermediate Nameserver MUST perform resolution as usual.  </t></section><section title="Support ECS and EIL at the same time" anchor="support-ecs-and-eil-at-the-same-time" toc="default"><t>Name servers can support ECS and EIL at the same time. ECS and EIL can&#8217;t be both initiated at the same DNS packet. It is better for user privacy if name servers initiate the EIL query prior to the ECS query.  </t><t>If Authoritative Nameservers support both ECS and EIL, Recursive resolvers can cache both ECS response and EIL response, there are some choices for Recursive Resolvers when they receive DNS queries.  </t><figure title="" suppress-title="false" align="left" alt="" width="" height=""><artwork xml:space="preserve" name="" type="" align="left" alt="" width="" height="">
Receive EIL query: 
    Search in EIL cache.
    If cache is matched, return EIL response.
    Otherwise, send EIL query to Authoritative Nameserver.

Receive ECS query: 
    Search in ECS cache.
    If cache is matched, return ECS response.
    Otherwise, send ECS query to Authoritative Nameserver.

Receive DNS query without EDNS option: 
    Search in ECS cache.
    If cache is matched, return ECS response.
    Otherwise,  
        Guess the isp location information of the client's IP, 
        build EIL option for the query packet.
        Search in EIL cache.
        If cache is matched, return EIL response.
        Otherwise, send EIL query to Authoritative Nameserver.

Receive DNS query with not-ECS/not-EIL option: 
    Search in not-EDNS cache.
    If cache is matched, return response.
    Otherwise, send the DNS query to Authoritative Nameserver.

Receive ECS query, improve user privacy: 
    Guess the isp location information of the client's IP, 
    build EIL option for the query packet.
    Search in EIL cache.
    If cache is matched, return EIL response RR with origin ECS option.
    Otherwise, send EIL query to Authoritative Nameserver.
</artwork></figure></section></section><section title="Delegations and Negative Answers" anchor="delegations-and-negative-answers" toc="default"><t>EIL's delegation case is similar with ECS, Additional and Authority Sections SHOULD ignore EIL.  </t><t>For negative answers, Authoritative Nameservers return traditional negative answers without EIL.  </t></section><section title="Transitivity" anchor="transitivity" toc="default"><t>EIL's transitivity concerns are similar with ECS.  </t><t>Name servers should only enable EIL where it is expected to benefit the end users, such as dealing with some latency-sensitive CDN domain queries in a complex network environment.  </t></section><section title="Response Accuracy" anchor="response-accuracy" toc="default"><t>Authoritative Nameservers that support ECS-enabled GeoIP feature can support EIL smoothly.  </t><t>Compared to ECS, EIL can reduce dependence on the IP geolocation database quality. EIL will rise the response accuracy of Authoritative Nameserver if its database can not find approximate isp location of ECS client subnet, ensure user latency. EIL will help Authoritative Nameservers to avoid cross-isp visit if its database can not find approximate isp location of ECS client subnet, save IP transit cost.  </t></section></section><section title="Security Considerations" anchor="security-considerations" toc="default"><section title="DNSSEC" anchor="dnssec" toc="default"><t>EIL is not signed.  </t></section><section title="Privacy" anchor="privacy" toc="default"><t>As mentioned in <xref target="RFC7871" pageno="false" format="default"/>'s abstract section, since ECS has some known operational and privacy shortcomings, a revision will be worked through the IETF for improvement. The biggest privacy concern on ECS is that client subnet information is personally identifiable. The more domains publish their zones on a third-party Authoritative Nameserver, the more end user privacy information can be gathered by the Authoritative Nameserver according to the ECS queries.  </t><t>EIL is to improve user privacy which is inspired by ECS, prevented leaks in the client subnet information.  </t><t>Like ECS, EIL will leak the global zonefile configurations of the Authoritative Nameservers more easily than normal case.  </t></section><section title="Target Censorship" anchor="target-censorship" toc="default"><t>DNS traffic is plain text by default. It is easily to be blocked or poisoned by internet target censorship. To bypass the censorship, it is better to encrypt the DNS traffic or use some proxy tunnel.  </t><t>EIL&#8217;s isp location information covers bigger area than ECS&#8217;s client subnet information. Therefore, compared to ECS in plain text condition, EIL is weaker at blocking record attack, but stronger at targeted DNS poisoning attack.  </t></section><section title="Cache Size" anchor="cache-size" toc="default"><t>Like ECS, cache size will raise if a Public Recursive Resolver supports EIL. The cache size of ECS grows up with the number of client subnets. The cache size of EIL is related to the row count in the &lt; COUNTRY-CODE, AREA-CODE, ISP &gt; isp location whitelist. Therefore, under IPv6 environment, the cache size of EIL will be smaller than ECS.  </t></section><section title="DDoS" anchor="ddos" toc="default"><t>To migrate the DDoS problem: </t><t><list style="symbols"><t>If an Authority Server receives a DNS query with unknown data in EIL option, it SHOULD return the default response whose EIL option with null value.  </t><t>Nameservers OPTIONAL only implement EIL when the query is from a TCP connection.  </t></list></t><t>More migration techniques described in <xref target="RFC7871" pageno="false" format="default"/>, Section 11.3.  </t></section></section><section title="IANA Considerations" anchor="iana-considerations" toc="default"><t>This document defines EIL, need request IANA to assign a new EDNS0 option code to EIL.  </t></section><section title="Acknowledgements" anchor="acknowledgements" toc="default"><t>EIL is inspired by ECS, the authors especially thanks to C.  Contavalli, W. van der Gaast, D. Lawrence, and W. Kumari.  </t><t>Thanks comments for Barry Raveendran Greene, Paul Vixie, Petr &#352;pa&#269;ek, Brian Hartvigsen, Ask Bj&#248;rn Hansen.  </t><t>Thanks a lot to all in the DNSOP, DNSPRIV and DNSEXT mailing list.  </t></section><section title="Appendix A. Example" anchor="appendix-a.-example" toc="default"><t>Authoritative Nameserver of www.example.com has enabled EIL.  </t><t>Stub DNS query A resource record of www.example.com .  </t><section title="Example 1: P-Model" anchor="example-1-p-model" toc="default"><figure title="" suppress-title="false" align="left" alt="" width="" height=""><artwork xml:space="preserve" name="" type="" align="left" alt="" width="" height="">
Stub DNS 
-&gt; Local Forwarding Resolver (61.48.7.2) 
-&gt; Public Forwarding Resolver(AliDNS, 223.5.5.5) 
-&gt; Public Recursive Resolver(AliDNS, 202.108.250.231) 
-&gt; Authoritative Nameserver
</artwork></figure><t>Public Forwarding Resolver 223.5.5.5 could enable EIL and generate the EIL OPT data &lt; CN, 11, UNI &gt; based on 61.48.7.2.  </t><t>P-Model will not leak client subnet to Authoritative Nameserver.  </t></section><section title="Example 2: I-Model" anchor="example-2-i-model" toc="default"><figure title="" suppress-title="false" align="left" alt="" width="" height=""><artwork xml:space="preserve" name="" type="" align="left" alt="" width="" height="">
Stub DNS 
-&gt; Local Forwarding Resolver 
-&gt; ISP Forwarding Resolver(202.106.196.115) 
-&gt; ISP Recursive Resolver(61.135.23.92) 
-&gt; Authoritative Nameserver
</artwork></figure><t>ISP Recursive Resolver 61.135.23.92 could enable EIL and generate the EIL OPT data &lt; CN, 11, UNI &gt; based on 61.135.23.92.  </t><t>If Authoritative Nameserver doesn't know much about 61.135.23.92, EIL will be helpful.  </t></section><section title="Example 3: L-Model" anchor="example-3-l-model" toc="default"><figure title="" suppress-title="false" align="left" alt="" width="" height=""><artwork xml:space="preserve" name="" type="" align="left" alt="" width="" height="">
Stub DNS 
-&gt; Local Fowarding Resolver(58.60.109.234) 
-&gt; ... 
-&gt; Authoritative Nameserver
</artwork></figure><t>Local Fowarding Resolver 58.60.109.234 could enable EIL and generate the option data is &lt; CN, 44, TEL &gt; based on 58.60.109.234.  </t><t>L-Model can give the most precisely isp location information for DNS resolution.  </t></section></section> </middle>
  <back>
    <references title="Normative References"><reference anchor="RFC1034" quote-title="true"><front><title>Domain Names - Concepts and Facilities</title><author initials="P." surname="Mockapetris" fullname=""><organization/></author><date year="1987" month="November"/></front><seriesInfo name="RFC" value="1034"/><format type="TXT" target="http://www.rfc-editor.org/rfc/rfc1034.txt"/></reference><reference anchor="RFC1035" quote-title="true"><front><title>Domain Names - Implementation and Specification</title><author initials="P." surname="Mockapetris" fullname=""><organization/></author><date year="1987" month="November"/></front><seriesInfo name="RFC" value="1035"/><format type="TXT" target="http://www.rfc-editor.org/rfc/rfc1035.txt"/></reference><reference anchor="RFC1700" quote-title="true"><front><title>Assigned Numbers</title><author initials="J." surname="Reynolds" fullname=""><organization/></author><author initials="J." surname="Postel" fullname=""><organization/></author><date year="1994" month="October"/></front><seriesInfo name="RFC" value="1700"/><format type="TXT" target="http://www.rfc-editor.org/rfc/rfc1700.txt"/></reference><reference anchor="RFC2119" quote-title="true"><front><title>Key words for use in RFCs to Indicate Requirement Levels</title><author initials="S." surname="Bradner" fullname=""><organization/></author><date year="1997" month="March"/></front><seriesInfo name="RFC" value="2119"/><format type="TXT" target="http://www.rfc-editor.org/rfc/rfc2119.txt"/></reference><reference anchor="RFC2182" quote-title="true"><front><title>Selection and Operation of Secondary DNS Servers</title><author initials="R." surname="ELZ" fullname=""><organization/></author><author initials="R." surname="Bush" fullname=""><organization/></author><author initials="S." surname="Bradner" fullname=""><organization/></author><author initials="M." surname="Patton" fullname=""><organization/></author><date year="1997" month="July"/></front><seriesInfo name="RFC" value="2182"/><format type="TXT" target="http://www.rfc-editor.org/rfc/rfc2182.txt"/></reference><reference anchor="RFC6891" quote-title="true"><front><title>Extension Mechanisms for DNS (EDNS(0))</title><author initials="J." surname="Damas" fullname=""><organization/></author><author initials="M." surname="Graff" fullname=""><organization/></author><author initials="P." surname="Vixie" fullname=""><organization/></author><date year="2013" month="April"/></front><seriesInfo name="RFC" value="6891"/><format type="TXT" target="http://www.rfc-editor.org/rfc/rfc6891.txt"/></reference><reference anchor="RFC7719" quote-title="true"><front><title>DNS Terminology</title><author initials="P." surname="Hoffman" fullname=""><organization/></author><author initials="A." surname="Sullivan" fullname=""><organization/></author><author initials="K." surname="Fujiwara" fullname=""><organization/></author><date year="2015" month="December"/></front><seriesInfo name="RFC" value="7719"/><format type="TXT" target="http://www.rfc-editor.org/rfc/rfc7719.txt"/></reference><reference anchor="RFC7871" quote-title="true"><front><title>Client Subnet in DNS Queries</title><author initials="C." surname="Contavalli" fullname=""><organization/></author><author initials="W." surname="van der Gasst" fullname=""><organization/></author><author initials="D." surname="Lawrence" fullname=""><organization/></author><author initials="W." surname="Kumari" fullname=""><organization/></author><date year="2016" month="May"/></front><seriesInfo name="RFC" value="7871"/><format type="TXT" target="http://www.rfc-editor.org/rfc/rfc7871.txt"/></reference> </references>
    <references title="Informative References"><reference anchor="BIND-GeoIP" target="https://kb.isc.org/article/AA-01149/0" quote-title="true"><front><title abbrev="BIND-GeoIP">Using the GeoIP Features in BIND 9.10</title><author initials="" surname="" fullname=""><organization>ISC BIND</organization><address><email/></address></author><date year="" month=""/></front><format type="" target=""/></reference><reference anchor="PowerDNS-GeoIP" target="https://doc.powerdns.com/md/authoritative/backend-geoip/" quote-title="true"><front><title abbrev="PowerDNS-GeoIP">PowerDNS GeoIP backend</title><author initials="" surname="" fullname=""><organization>PowerDNS</organization><address><email/></address></author><date year="" month=""/></front><format type="" target=""/></reference><reference anchor="Amazon-Geolocation-Routing" target="http://docs.aws.amazon.com/Route53/latest/DeveloperGuide/routing-policy.html#routing-policy-geo" quote-title="true"><front><title abbrev="Amazon-Geolocation-Routing">Amazon Route 53: Geolocation Routing</title><author initials="" surname="" fullname=""><organization>Amazon</organization><address><email/></address></author><date year="" month=""/></front><format type="" target=""/></reference><reference anchor="DYN-Traffic-Director-ECS" target="https://help.dyn.com/edns-client-subnet-faq-info/#q6" quote-title="true"><front><title abbrev="DYN-Traffic-Director-ECS">What happens when a DNS query for a Traffic Director instance is received with ECS information</title><author initials="" surname="" fullname=""><organization>DYN</organization><address><email/></address></author><date year="" month=""/></front><format type="" target=""/></reference><reference anchor="gdnsd-GeoIP" target="https://github.com/gdnsd/gdnsd/wiki/GdnsdPluginGeoip" quote-title="true"><front><title abbrev="gdnsd-GeoIP">GdnsdPluginGeoip</title><author initials="" surname="" fullname=""><organization>gdnsd</organization><address><email/></address></author><date year="" month=""/></front><format type="" target=""/></reference><reference anchor="ISO3166" target="http://www.iso.org/iso/country_codes" quote-title="true"><front><title abbrev="Country Codes">Country Codes</title><author initials="" surname="" fullname=""><organization>ISO 3166</organization><address><email/></address></author><date year="" month=""/></front><format type="" target=""/></reference> </references>
  </back>
</rfc>
